# Last Modified: Wed Feb 22 17:53:04 2017
@{PID} = {[1-9],[1-9][0-9],[1-9][0-9][0-9],[1-9][0-9][0-9][0-9],[1-9][0-9][0-9][0-9][0-9],[1-9][0-9][0-9][0-9][0-9][0-9]}

#########################################
# Generic Firejail AppArmor profile
#########################################
##########
# A simple PID declaration based on Ubuntu's @{pid}
# Ubuntu keeps it under tunables/kernelvars and include it via tunables/global.
# We don't know if this definition is available outside Debian and Ubuntu, so
# we declare our own here.
##########


profile firejail-default {
  #include <abstractions/consoles>

  capability audit_control,
  capability audit_write,
  capability chown,
  capability dac_override,
  capability dac_read_search,
  capability fowner,
  capability fsetid,
  capability ipc_lock,
  capability ipc_owner,
  capability kill,
  capability lease,
  capability linux_immutable,
  capability mac_admin,
  capability mac_override,
  capability mknod,
  capability net_admin,
  capability net_bind_service,
  capability net_broadcast,
  capability net_raw,
  capability setfcap,
  capability setgid,
  capability setpcap,
  capability setuid,
  capability sys_admin,
  capability sys_boot,
  capability sys_chroot,
  capability sys_module,
  capability sys_nice,
  capability sys_pacct,
  capability sys_ptrace,
  capability sys_rawio,
  capability sys_resource,
  capability sys_time,
  capability sys_tty_config,

  network inet,
  network inet6,
  network netlink,
  network raw,
  network unix,

  mount,
  remount,
  umount,

  signal,

  pivot_root,

  / r,
  /[^proc,^sys]** mrwlk,
  /bin/** ix,
  /lib/** ix,
  /lib64/** ix,
  /opt/ r,
  /opt/** ix,
  /opt/** r,
  /opt/firefox/update.test rw,
  /opt/firefox/update.test/ rw,
  /opt/thunderbird/update.test rw,
  /opt/thunderbird/update.test/ rw,
  /proc/ r,
  /proc/*/net/arp r,
  /proc/*/net/route r,
  /proc/@{PID}/ r,
  /proc/@{PID}/cmdline r,
  /proc/@{PID}/comm r,
  /proc/@{PID}/fd/ r,
  /proc/@{PID}/maps r,
  /proc/@{PID}/mountinfo r,
  /proc/@{PID}/mounts r,
  /proc/@{PID}/oom_score_adj r,
  /proc/@{PID}/stat r,
  /proc/@{PID}/statm r,
  /proc/@{PID}/status r,
  /proc/@{PID}/task/ r,
  /proc/@{PID}/task/@{PID}/stat r,
  /proc/asound/card[0-9]/ r,
  /proc/asound/card[0-9]/** r,
  /proc/cpuinfo r,
  /proc/filesystems r,
  /proc/loadavg r,
  /proc/meminfo r,
  /proc/stat r,
  /proc/sys/kernel/osrelease r,
  /proc/sys/kernel/pid_max r,
  /proc/sys/kernel/shmmax r,
  /proc/sys/vm/overcommit_memory r,
  /proc/sys/vm/overcommit_ratio r,
  /proc/uptime r,
  /sbin/** ix,
  /sys/ r,
  /sys/bus/ r,
  /sys/bus/** r,
  /sys/class/ r,
  /sys/class/** r,
  /sys/devices/ r,
  /sys/devices/** r,
  /usr/bin/** ix,
  /usr/games/** ix,
  /usr/lib/** ix,
  /usr/lib64/gstreamer-1.0/gst-plugin-scanner Px,
  /usr/lib64/kde4/libexec/lnusertemp ix,
  /usr/local/** ix,
  /usr/sbin/** ix,
  /{,var/}run/ r,
  /{,var/}run/** r,
  /{,var/}run/firejail/appimage r,
  /{,var/}run/firejail/appimage/** rix,
  /{,var/}run/firejail/mnt/fslogger r,
  /{,var/}run/user/**/dconf/ rw,
  /{,var/}run/user/**/dconf/user rw,
  /{,var/}run/user/**/pulse/ rw,
  /{,var/}run/user/**/pulse/** rw,
  /{run,dev}/shm/ r,
  /{run,dev}/shm/** mrwk,

}
